(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[644],{70840:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/loader",function(){return n(67298)}])},67298:function(e,t,n){"use strict";let a;n.r(t),n.d(t,{default:function(){return _}});var i=n(85893),r=n(6154);async function l(e){return new Promise((t,n)=>{let a=new Image,i=new Uint8Array(e),r=new Blob([i]),l=window.URL||window.webkitURL,o=l.createObjectURL(r);a.src=o,a.onload=()=>{t(a),l.revokeObjectURL(o)},a.onerror=e=>{l.revokeObjectURL(o),n(e)}})}function o(e,t){let n=e.replace("web:",""),i=new Promise(async(i,o)=>{try{let o=await (0,r.Z)({method:"GET",responseType:"arraybuffer",url:n}),u=await l((await o).data),d=function(e,t){let n=e.naturalHeight,i=e.naturalWidth,r=document.createElement("canvas");return{imageId:t,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:255,getPixelData:function(n){let i,l;let o=(a===t?l=r.getContext("2d"):(r.height=e.naturalHeight,r.width=e.naturalWidth,(l=r.getContext("2d")).drawImage(e,0,0),a=t),l.getImageData(0,0,e.naturalWidth,e.naturalHeight));return i=n?new Uint8Array(n.arrayBuffer,n.offset,n.length):new Uint8Array(o.width*o.height*3),function(e,t){for(let n=0,a=0;n<e.data.length;n+=4,a+=3)t[a]=e.data[n],t[a+1]=e.data[n+1],t[a+2]=e.data[n+2]}(o,i),i},getCanvas:function(){if(a===t)return r;r.height=e.naturalHeight,r.width=e.naturalWidth;let n=r.getContext("2d");return n.drawImage(e,0,0),a=t,r},getImage:()=>e,rows:n,columns:i,height:n,width:i,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:n*i*3}}(u,e);t&&t.targetBuffer&&t.targetBuffer.length&&t.targetBuffer.offset?(image.getPixelData(t.targetBuffer),i(!0)):i(d)}catch(e){o(e)}});return{promise:i,cancelFn:void 0}}var u=n(67294),d=n(99496),c=n(67937),s=n(90629),g=n(51233),w=n(15861),f=n(83321);function h(){let e=(0,d.AR)(),t=(0,u.useRef)(null),a="CT_AXIAL_STACK",[r,l]=(0,u.useState)("myRenderingEngine"),[h,m]=(0,u.useState)([]),[p,v]=(0,u.useState)(),[_,x]=(0,u.useState)(!1),[C,b]=(0,u.useState)();return(0,u.useEffect)(()=>{async function e(){let{RenderingEngine:e,Enums:i}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(42)]).then(n.bind(n,47391)),{ViewportType:l}=i,o=new e(r);if(t.current){let e=t.current,n={viewportId:a,element:e,type:l.STACK};null==o||o.enableElement(n);let i=null==o?void 0:o.getViewport(a);null==i||i.render()}}(async function(){let t=await Promise.all([n.e(123),n.e(609),n.e(610),n.e(5),n.e(391),n.e(669),n.e(625)]).then(n.bind(n,51765)).then(e=>e.default).catch(()=>()=>{});await t(),await e();let{imageLoader:a}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(42)]).then(n.bind(n,47391));(function(e){e.registerImageLoader("web",o)})(a),m(["web:DIRECT.png"]),document.getElementsByClassName("cornerstone-canvas")[0].id="dicom-canvas"})()},[r]),(0,u.useEffect)(()=>{async function e(){let{getRenderingEngine:e,metaData:t}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(42)]).then(n.bind(n,47391));t.addProvider((e,t)=>(function(e,t,n){let a=t.indexOf(":"),i=t.substring(0,a);if("web"===i){if("imagePixelModule"===e)return{pixelRepresentation:0,bitsAllocated:24,bitsStored:24,highBit:24,photometricInterpretation:"RGB",samplesPerPixel:3};if("generalSeriesModule"===e)return{modality:"SC",seriesNumber:1,seriesDescription:"Color",seriesDate:"20190201",seriesTime:"120000",seriesInstanceUID:"1.2.276.0.7230010.3.1.4.83233.20190201120000.1"};if("imagePlaneModule"===e){let e=n.indexOf(t);return{imageOrientationPatient:[1,0,0,0,1,0],imagePositionPatient:[0,0,5*e],pixelSpacing:[1,1],columnPixelSpacing:1,rowPixelSpacing:1,frameOfReferenceUID:"FORUID",columns:2048,rows:1216,rowCosines:[1,0,0],columnCosines:[0,1,0]}}return"voiLutModule"===e?{windowWidth:[256],windowCenter:[128]}:"modalityLutModule"===e?{rescaleSlope:1,rescaleIntercept:0}:void 0}})(e,t,h),1e3);let i=e(r),l=null==i?void 0:i.getViewport(a);l&&"setStack"in l&&await (null==l?void 0:l.setStack(h,0)),null==l||l.render()}async function t(){await e()}h.length>0&&t()},[r,h,e]),(0,i.jsx)(s.Z,{children:(0,i.jsxs)(g.Z,{children:[(0,i.jsxs)("select",{name:"a",id:"a",onChange:e=>{console.log(e.target.value),m([e.target.value])},children:[(0,i.jsx)("option",{value:"web:dentigate_origin.png",children:"dentigate_origin.png"}),(0,i.jsx)("option",{value:"web:dentigate_other.png",children:"dentigate_other.png"}),(0,i.jsx)("option",{value:"web:dentigate_our_val2.png",children:"dentigate_our_val2.png"}),(0,i.jsx)("option",{value:"web:dentigate_our_val3.png",children:"dentigate_our_val3.png"}),(0,i.jsx)("option",{value:"web:dentigate_new_our_val3.png",children:"dentigate_new_our_val3.png"})]}),(0,i.jsx)("input",{type:"file",onChange:e=>{e.target&&e.target.files&&(console.log(URL.createObjectURL(e.target.files[0])),console.log(e.target.value),console.log(e.target.files))}}),(0,i.jsx)("div",{id:"viewer",ref:t,style:{width:"40rem",aspectRatio:1,margin:"0 auto"}}),(0,i.jsxs)(g.Z,{children:[(0,i.jsx)(w.Z,{children:"Score"}),(0,i.jsxs)(w.Z,{children:["AGM: ",p]}),(0,i.jsxs)(w.Z,{children:["SSIM: ",C]})]}),(0,i.jsx)(f.Z,{onClick:t=>{t.preventDefault(),t.stopPropagation(),v(function(){if(e&&e.loaded&&document.getElementById("dicom-canvas")){let{cv:t}=e,n=t.imread("dicom-canvas");t.cvtColor(n,n,t.COLOR_RGBA2GRAY,0),n.convertTo(n,t.CV_64F);let a=(0,c.Z5)(t,n);if(n.convertTo(n,t.CV_8U),_||"web:dentigate_origin.png"!==h[0]){if(_){let e=(0,c.TI)("origin-canvas","dicom-canvas");b(e)}}else{let e=document.createElement("canvas");e.id="origin-canvas",document.body.appendChild(e),t.imshow("origin-canvas",n),x(!0)}return a}}())},variant:"contained",children:"점수 얻기"})]})})}var m=n(21265),p=n(22430);let v=(0,m.Z)({palette:{mode:"dark"}});function _(){return(0,i.jsx)(d.mK,{openCvPath:"opencv.js",children:(0,i.jsx)(p.Z,{theme:v,children:(0,i.jsx)(h,{})})})}},67937:function(e,t,n){"use strict";n.d(t,{TI:function(){return l},Tr:function(){return r},Z5:function(){return o}});var a=n(10556),i=n.n(a);let r=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=new e.Mat,r=new e.Mat,l=new e.Mat;t.convertTo(i,e.CV_64F),n.convertTo(r,e.CV_64F),e.subtract(i,r,l),e.multiply(l,l,l);let o=Math.max(Number.EPSILON,e.mean(l)[0]);return l.delete(),i.delete(),r.delete(),20*Math.log10(a/Math.sqrt(o))},l=(e,t)=>{let n=document.getElementById(e),a=document.getElementById(t);if(!(n instanceof HTMLCanvasElement&&a instanceof HTMLCanvasElement))return NaN;{let e=n.getContext("2d",{willReadFrequently:!0}),t=a.getContext("2d",{willReadFrequently:!0}),r=null==e?void 0:e.getImageData(0,0,n.width,n.height),l=null==t?void 0:t.getImageData(0,0,a.width,a.height),{mssim:o}=r&&l?i()(r,l):{mssim:NaN};return o}},o=(e,t)=>{let n=new e.Mat;t.convertTo(n,e.CV_64F);let a=new e.Mat,i=new e.Mat;e.Sobel(n,a,e.CV_64F,1,0),e.Sobel(n,i,e.CV_64F,0,1),e.multiply(a,a,a),e.multiply(i,i,i),e.add(a,i,n),e.sqrt(n,n);let r=e.mean(n)[0];return n.delete(),a.delete(),i.delete(),r}}},function(e){e.O(0,[774,130,876,172,888,179],function(){return e(e.s=70840)}),_N_E=e.O()}]);