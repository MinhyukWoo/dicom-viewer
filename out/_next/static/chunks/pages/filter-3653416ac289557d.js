(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[540],{62481:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/filter",function(){return n(86080)}])},86080:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return V}});var a=n(85893),l=n(99496),i=n(90629),s=n(86886),o=n(67294),r=n(21265),c=n(22430),d=n(66720),u=n(77651),m=n(46901),h=n(85739),x=n(72096),j=n(18972),Z=n(48885),p=n(13665),v=n(59994),f=n(31727),w=n(36833),P=n(74005),C=n(51233),g=n(87357),y=n(45929),S=n(72852),b=n(83321),T=n(10556),_=n.n(T);let E=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;t.convertTo(t,e.CV_32F),n.convertTo(n,e.CV_32F);let l=new e.Mat;e.subtract(t,n,l),e.multiply(l,l,l);let i=Math.max(Number.EPSILON,e.mean(l)[0]);return 20*Math.log10(a/Math.sqrt(i))},k=()=>{let e=document.getElementById("canvas-input"),t=document.getElementById("canvas-output");if(!(e instanceof HTMLCanvasElement&&t instanceof HTMLCanvasElement))return NaN;{let n=e.getContext("2d"),a=t.getContext("2d"),l=null==n?void 0:n.getImageData(0,0,e.width,e.height),i=null==a?void 0:a.getImageData(0,0,t.width,t.height),{mssim:s}=l&&i?_()(l,i):{mssim:NaN};return s}};function M(){let e=(0,l.AR)(),[t,n]=(0,o.useState)(9),[i,r]=(0,o.useState)(3),[c,d]=(0,o.useState)(1),[u,m]=(0,o.useState)(1),[h,x]=(0,o.useState)(1),[j,Z]=(0,o.useState)(!1),[p,v]=(0,o.useState)(!1),[f,w]=(0,o.useState)(!1),[P,T]=(0,o.useState)(!1),[_,M]=(0,o.useState)(40),[N,A]=(0,o.useState)(8),[L,V]=(0,o.useState)(3),[D,F]=(0,o.useState)(1),[R,B]=(0,o.useState)(!1),[I,U]=(0,o.useState)(20),[G,O]=(0,o.useState)(0),[z,H]=(0,o.useState)(0),q=(e,t,n)=>{let a=t.clone();return t.convertTo(a,e.CV_32F),e.pow(a,1/n,a),a.convertTo(a,e.CV_8U),a},K=(e,t,n)=>{let a=t.clone(),l=new e.Scalar(1),i=new e.Mat(a.rows,a.cols,e.CV_32FC1,l);return t.convertTo(a,e.CV_32F),e.multiply(a,i,a,n),a.convertTo(a,e.CV_8U),i.delete(),a},W=(e,t,n)=>{let a=t.clone(),l=new e.Scalar(255),i=new e.Scalar(1),s=new e.Scalar(0),o=new e.Mat(a.rows,a.cols,e.CV_8UC1,l),r=new e.Mat(a.rows,a.cols,e.CV_32FC1,i),c=new e.Mat(a.rows,a.cols,e.CV_8UC1,s),d=t.clone();return e.subtract(o,d,d),e.add(d,c,d),d.convertTo(d,e.CV_32F),e.multiply(d,r,d,1-n),d.convertTo(d,e.CV_8U),e.add(a,d,a),o.delete(),r.delete(),c.delete(),d.delete(),a},X=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:9,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;if(a%2!=1)return t;{let l=new e.Mat,i=(1-n)/(a*a-1),s=Array(a*a).fill(i),o=(1+a*a)/2;s[o]=n;let r=e.matFromArray(a,a,e.CV_32FC1,s),c=new e.Point(-1,-1);return e.filter2D(t,l,e.CV_8U,r,c,0,e.BORDER_DEFAULT),l}},Y=(e,t)=>{let n=t.clone();return e.equalizeHist(n,n),n},J=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,l=new e.Mat,i=new e.Mat;e.equalizeHist(t,l);let s=new e.CLAHE(a,new e.Size(n,n));return s.apply(t,i),l.delete(),s.delete(),i},Q=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=new e.Mat,i=new e.Size(n,n);return e.GaussianBlur(t,l,i,0,0,e.BORDER_DEFAULT),e.addWeighted(t,1-a,l,a,0,l),l},$=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=new e.Mat(t.rows,t.cols,e.CV_8U),l=e.matFromArray(1,1,e.CV_32F,[0]),i=e.matFromArray(1,1,e.CV_32F,[n]);e.randn(a,l,i);let s=new e.Mat;return e.add(t,a,s),s};async function ee(){if(e&&e.loaded){let{cv:n}=e,a=document.querySelector("#viewer canvas");if(a){let e=await n.imread("canvas-input",n.IMREAD_GRAYSCALE);n.cvtColor(e,e,n.COLOR_RGBA2GRAY,0);let a=await q(n,e,c),l=await K(n,a,u),s=await W(n,l,h),o=p?await Y(n,s):s,r=R?await $(n,o,I):o,d=f?await J(n,r,N,_):r,m=P?await Q(n,d,L,D):d,x=j?await X(n,m,t,i):m;await n.imshow("canvas-output",x),O(E(n,e,x)),H(k())}}}return(0,o.useEffect)(()=>{ee()},[t,i,c,u,h,j,p,f,P,_,N,L,D,R,I]),(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,md:2}),(0,a.jsx)(s.ZP,{item:!0,xs:12,md:!0,children:(0,a.jsxs)(C.Z,{children:[(0,a.jsxs)(g.Z,{children:["Gamma Corrected",(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:.01,min:.5,max:1.5,value:"number"==typeof c?c:1,onChange:(e,t)=>{d(t)}})]}),(0,a.jsxs)(g.Z,{children:["Black Compression",(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:.01,min:.5,max:1.5,value:"number"==typeof u?u:1,onChange:(e,t)=>{m(t)}})]}),(0,a.jsxs)(g.Z,{children:["White Compression",(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:.01,min:0,max:1,value:"number"==typeof h?h:1,onChange:(e,t)=>{x(t)}})]}),(0,a.jsxs)(g.Z,{children:["Histogram Equalization",(0,a.jsx)(S.Z,{checked:p,onChange:e=>{v(e.target.checked)}})]}),(0,a.jsxs)(g.Z,{children:["CLAHE",(0,a.jsx)(S.Z,{checked:f,onChange:e=>{w(e.target.checked)}}),f&&(0,a.jsxs)(C.Z,{children:[(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Tile Grid Size"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:1,min:1,max:16,value:"number"==typeof N?N:8,onChange:(e,t)=>{A(t)}})})]}),(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Clip Limit"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:1,min:1,max:255,value:"number"==typeof _?_:40,onChange:(e,t)=>{M(t)}})})]})]})]}),(0,a.jsxs)(g.Z,{children:["Noise Adjustment",(0,a.jsx)(S.Z,{checked:R,onChange:e=>{B(e.target.checked)}}),R&&(0,a.jsx)(C.Z,{children:(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Scale"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:1,min:0,max:100,value:"number"==typeof I?I:20,onChange:(e,t)=>{U(t)}})})]})})]}),(0,a.jsxs)(g.Z,{children:["Definition Enhancement",(0,a.jsx)(S.Z,{checked:P,onChange:e=>{T(e.target.checked)}}),P&&(0,a.jsxs)(C.Z,{children:[(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Kernel Size"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:2,min:3,max:15,value:"number"==typeof L?L:3,onChange:(e,t)=>{V(t)}})})]}),(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Blur Weight"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:.1,min:-1,max:1,value:"number"==typeof D?D:1,onChange:(e,t)=>{F(t)}})})]})]})]}),(0,a.jsxs)(g.Z,{children:["Sharpen Filter",(0,a.jsx)(S.Z,{checked:j,onChange:e=>{Z(e.target.checked)}}),j&&(0,a.jsxs)(C.Z,{children:[(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Median Value"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:1,min:1,max:20,value:"number"==typeof t?t:9,onChange:(e,t)=>{n(t)}})})]}),(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:"- Kerenl Size"}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(y.ZP,{valueLabelDisplay:"auto",step:2,min:3,max:15,value:"number"==typeof i?i:3,onChange:(e,t)=>{r(t)}})})]})]})]}),(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:!0,children:(0,a.jsx)(b.Z,{variant:"outlined",color:"error",onClick:function(){Z(!1),v(!1),w(!1),n(9),r(3),d(1),m(1),x(1),T(!1),A(8),M(40),V(3),F(1),B(!1),U(20)},children:"Reset"})}),(0,a.jsx)(s.ZP,{item:!0,children:(0,a.jsx)(b.Z,{variant:"contained",color:"primary",onClick:ee,children:"Apply"})})]}),(0,a.jsxs)(C.Z,{children:[(0,a.jsx)(g.Z,{children:"Score"}),(0,a.jsxs)(g.Z,{children:["- PSNR: ",G.toFixed(5)]}),(0,a.jsxs)(g.Z,{children:["- SSIM: ",z.toFixed(5)]})]})]})}),(0,a.jsx)(s.ZP,{item:!0,md:2})]})}let N=(0,r.Z)({palette:{mode:"dark"}}),A=[{field:"key",headerName:"KEY",flex:1},{field:"value",headerName:"VALUE",flex:1}];function L(){let e="CT_AXIAL_STACK",t="myToolGroup",r=(0,o.useRef)(null),[C,g]=(0,o.useState)([]),[y,S]=(0,o.useState)([]),[b,T]=(0,o.useState)(!1),[_,E]=(0,o.useState)("myRenderingEngine"),[k,L]=(0,o.useState)(),V=(0,l.AR)();async function D(e){let a=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005)),{ToolGroupManager:l,Enums:i}=a;if(k!==e){let n=l.getToolGroup(t);null==n||n.setToolActive(e,{bindings:[{mouseButton:i.MouseBindings.Primary}]}),k&&(null==n||n.setToolPassive(k)),L(e)}}return(0,o.useEffect)(()=>{async function a(){let{RenderingEngine:t,Enums:a}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),{ViewportType:l}=a,i=new t(_);if(r.current){let t=r.current,n={viewportId:e,element:t,type:l.STACK};null==i||i.enableElement(n);let a=null==i?void 0:i.getViewport(e);null==a||a.render()}}async function l(){let a=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005)),{ToolGroupManager:l,ZoomTool:i,WindowLevelTool:s,LengthTool:o,PanTool:r,utilities:c,Enums:d}=a;a.removeTool(i),a.removeTool(s),a.removeTool(o),a.removeTool(r),a.addTool(i),a.addTool(s),a.addTool(o),a.addTool(r);let u=l.createToolGroup(t);null==u||u.addTool(i.toolName),null==u||u.addTool(s.toolName),null==u||u.addTool(o.toolName),null==u||u.addTool(r.toolName),null==u||u.addViewport(e,_),null==u||u.setToolActive(s.toolName,{bindings:[{mouseButton:d.MouseBindings.Primary}]}),L(s.toolName)}(async function(){let e=await Promise.all([n.e(123),n.e(609),n.e(610),n.e(5),n.e(391),n.e(669),n.e(625)]).then(n.bind(n,51765)).then(e=>e.default).catch(()=>()=>{});await e(),await a(),await l(),S(()=>["wadouri:I0000164.dcm"])})()},[_]),(0,o.useEffect)(()=>{async function t(){let{getRenderingEngine:t}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),a=t(_),l=null==a?void 0:a.getViewport(e);l&&"setStack"in l&&await (null==l?void 0:l.setStack(y,0)),null==l||l.render();let{metaData:i}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),s=["transferSyntax","sopCommonModule","imagePixelModule","voiLutModule"].map(e=>i.get(e,y[0])).filter(e=>!!e).map(e=>Object.entries(e).map(e=>{let[t,n]=e;return{key:t,value:n}})).reduce((e,t)=>[...e,...t],[]);g(()=>s.map((e,t)=>({...e,id:t})))}y.length>0?(T(!1),t()):T(!0)},[_,y]),(0,o.useEffect)(()=>{if(V&&V.loaded){let{cv:e}=V,t=document.querySelector("#viewer canvas");if(t){t.id="canvas-input";let n=e.imread("canvas-input");e.imshow("canvas-output",n)}}},[_,y,V]),(0,a.jsxs)(c.Z,{theme:N,children:[(0,a.jsx)(d.ZP,{}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)("input",{type:"file",accept:"*/dicom",onChange:e=>{e.preventDefault(),e.stopPropagation(),e.target.files&&function(e){async function t(){let t=await n.e(609).then(n.t.bind(n,33245,23)),a=t.wadouri.fileManager.add(e[0]);S(()=>[a])}e&&t()}(e.target.files)},style:{width:"100%"}}),(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,xs:1,children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{WindowLevelTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));D(e.toolName)})()},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(p.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{PanTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));D(e.toolName)})()},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(w.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{ZoomTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));D(e.toolName)})()},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(P.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{LengthTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));D(e.toolName)})()},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(f.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{getRenderingEngine:t}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),a=t(_),l=null==a?void 0:a.getViewport(e);null==l||l.resetCamera(),l&&"resetProperties"in l&&(null==l||l.resetProperties()),null==l||l.render()})()},children:(0,a.jsx)(Z.Z,{children:(0,a.jsx)(v.Z,{})})})]})}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,md:!0,children:(0,a.jsx)("div",{id:"viewer",ref:r,style:{maxWidth:"30rem",aspectRatio:1,margin:"0 auto"}})}),(0,a.jsx)(s.ZP,{item:!0,xs:!0,md:!0,children:(0,a.jsx)("canvas",{id:"canvas-output",style:{maxWidth:"30rem",aspectRatio:1,margin:"0 auto"}})}),(0,a.jsx)(s.ZP,{item:!0,xs:3,children:(0,a.jsx)(M,{})})]}),C.length>0&&(0,a.jsxs)(s.ZP,{container:!0,children:[(0,a.jsx)(s.ZP,{item:!0,md:1}),(0,a.jsx)(s.ZP,{item:!0,xs:12,md:!0,children:(0,a.jsx)(h._,{rows:C,columns:A})}),(0,a.jsx)(s.ZP,{item:!0,md:1})]}),(0,a.jsx)(u.Z,{open:b,onClose:()=>{T(!1)},children:(0,a.jsx)(m.Z,{severity:"info",children:"DICOM 파일을 업로드해주세요."})})]})]})}function V(){return(0,a.jsx)(l.mK,{onLoad:e=>{console.log("opencv loaded",e)},openCvPath:"opencv.js",children:(0,a.jsx)(L,{})})}}},function(e){e.O(0,[774,97,621,888,179],function(){return e(e.s=62481)}),_N_E=e.O()}]);