(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[540],{62481:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/filter",function(){return n(86080)}])},86080:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return A}});var a=n(85893),i=n(99496),l=n(90629),o=n(86886),s=n(67294),r=n(21265),c=n(22430),d=n(66720),u=n(77651),m=n(46901),h=n(85739),x=n(72096),j=n(18972),p=n(48885),w=n(13665),Z=n(59994),f=n(31727),v=n(36833),C=n(74005),P=n(51233),y=n(87357),g=n(45929),S=n(72852),T=n(83321);function b(){let e=(0,i.AR)(),[t,n]=(0,s.useState)(9),[l,r]=(0,s.useState)(1),[c,d]=(0,s.useState)(1),[u,m]=(0,s.useState)(1),[h,x]=(0,s.useState)(!1),[j,p]=(0,s.useState)(!1),[w,Z]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!1),[C,b]=(0,s.useState)(40),[_,k]=(0,s.useState)(),E=(e,t,n)=>{let a=t.clone();return t.convertTo(a,e.CV_32F),e.pow(a,1/n,a),a.convertTo(a,e.CV_8U),a},A=(e,t,n)=>{let a=t.clone(),i=new e.Scalar(1),l=new e.Mat(a.rows,a.cols,e.CV_32FC1,i);return t.convertTo(a,e.CV_32F),e.multiply(a,l,a,n),a.convertTo(a,e.CV_8U),l.delete(),a},L=(e,t,n)=>{let a=t.clone(),i=new e.Scalar(255),l=new e.Scalar(1),o=new e.Scalar(0),s=new e.Mat(a.rows,a.cols,e.CV_8UC1,i),r=new e.Mat(a.rows,a.cols,e.CV_32FC1,l),c=new e.Mat(a.rows,a.cols,e.CV_8UC1,o),d=t.clone();return e.subtract(s,d,d),e.add(d,c,d),d.convertTo(d,e.CV_32F),e.multiply(d,r,d,1-n),d.convertTo(d,e.CV_8U),e.add(a,d,a),s.delete(),r.delete(),c.delete(),d.delete(),a},N=(e,t,n)=>{let a=new e.Mat,i=[-1,-1,-1,-1,n,-1,-1,-1,-1],l=e.matFromArray(3,3,e.CV_32FC1,i),o=new e.Point(-1,-1);return e.filter2D(t,a,e.CV_8U,l,o,0,e.BORDER_DEFAULT),a},V=(e,t)=>{let n=t.clone();return e.equalizeHist(n,n),n},M=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,i=new e.Mat,l=new e.Mat;e.equalizeHist(t,i);let o=new e.Size(n,n),s=new e.CLAHE(a,o);return s.apply(t,l),i.delete(),s.delete(),l},R=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,a=new e.Mat,i=new e.Size(n,n);return e.GaussianBlur(t,a,i,0,0,e.BORDER_DEFAULT),e.addWeighted(t,.5,a,.5,0,a),a};async function D(){if(e&&e.loaded){let{cv:n}=e,a=document.querySelector("#viewer canvas");if(a){let e=await n.imread("canvas-input",n.IMREAD_GRAYSCALE);n.cvtColor(e,e,n.COLOR_RGBA2GRAY,0);let a=await E(n,e,l),i=await A(n,a,c),o=await L(n,i,u),s=j?await V(n,o):o,r=w?await M(n,s,_,C):s,d=f?await R(n,e):r,m=h?await N(n,d,t):d;await n.imshow("canvas-output",m)}}}return(0,a.jsxs)(o.ZP,{container:!0,children:[(0,a.jsx)(o.ZP,{item:!0,md:2}),(0,a.jsx)(o.ZP,{item:!0,xs:12,md:!0,children:(0,a.jsxs)(P.Z,{children:[(0,a.jsxs)(y.Z,{children:["Gamma Corrected",(0,a.jsx)(g.ZP,{valueLabelDisplay:"auto",step:.01,min:.5,max:1.5,value:"number"==typeof l?l:1,onChange:(e,t)=>{r(t)}})]}),(0,a.jsxs)(y.Z,{children:["Black Compression",(0,a.jsx)(g.ZP,{valueLabelDisplay:"auto",step:.01,min:.5,max:1.5,value:"number"==typeof c?c:1,onChange:(e,t)=>{d(t)}})]}),(0,a.jsxs)(y.Z,{children:["White Compression",(0,a.jsx)(g.ZP,{valueLabelDisplay:"auto",step:.01,min:0,max:1,value:"number"==typeof u?u:1,onChange:(e,t)=>{m(t)}})]}),(0,a.jsxs)(y.Z,{children:["Equalize Histogram",(0,a.jsx)(S.Z,{checked:j,onChange:e=>{p(e.target.checked)}})]}),(0,a.jsxs)(y.Z,{children:["CLAHE(Constrast Limited Adaptive Equalize Histogram)",(0,a.jsx)(S.Z,{checked:w,onChange:e=>{Z(e.target.checked)}}),w&&(0,a.jsxs)(P.Z,{children:[(0,a.jsxs)(o.ZP,{container:!0,children:[(0,a.jsx)(o.ZP,{item:!0,xs:1}),(0,a.jsx)(o.ZP,{item:!0,xs:2,children:"Tile Grid Size"}),(0,a.jsx)(o.ZP,{item:!0,xs:!0,children:(0,a.jsx)(g.ZP,{valueLabelDisplay:"auto",step:1,min:1,max:16,value:"number"==typeof _?_:8,onChange:(e,t)=>{k(t)}})})]}),(0,a.jsxs)(o.ZP,{container:!0,children:[(0,a.jsx)(o.ZP,{item:!0,xs:1}),(0,a.jsx)(o.ZP,{item:!0,xs:2,children:"Limit"}),(0,a.jsx)(o.ZP,{item:!0,xs:!0,children:(0,a.jsx)(g.ZP,{valueLabelDisplay:"auto",step:1,min:1,max:255,value:"number"==typeof C?C:40,onChange:(e,t)=>{b(t)}})})]})]})]}),(0,a.jsxs)(y.Z,{children:["Definition Enhancement(Gaussian Blurring & Weight sum)",(0,a.jsx)(S.Z,{checked:f,onChange:e=>{v(e.target.checked)}})]}),(0,a.jsxs)(y.Z,{children:["Sharpen Filter (Simple Convolution)",(0,a.jsx)(S.Z,{checked:h,onChange:e=>{x(e.target.checked)}}),h&&(0,a.jsx)(g.ZP,{valueLabelDisplay:"auto",step:1,min:0,max:10,value:"number"==typeof t?t:9,onChange:(e,t)=>{n(t)}})]}),(0,a.jsxs)(o.ZP,{container:!0,children:[(0,a.jsx)(o.ZP,{item:!0,xs:!0,children:(0,a.jsx)(T.Z,{variant:"outlined",color:"error",onClick:function(){x(!1),p(!1),Z(!1),n(9),r(1),d(1),m(1),v(!1),k(8),b(40)},children:"Reset"})}),(0,a.jsx)(o.ZP,{item:!0,children:(0,a.jsx)(T.Z,{variant:"contained",color:"primary",onClick:D,children:"Apply"})})]})]})}),(0,a.jsx)(o.ZP,{item:!0,md:2})]})}let _=(0,r.Z)({palette:{mode:"dark"}}),k=[{field:"key",headerName:"KEY",flex:1},{field:"value",headerName:"VALUE",flex:1}];function E(){let e="CT_AXIAL_STACK",t="myToolGroup",r=(0,s.useRef)(null),[P,y]=(0,s.useState)([]),[g,S]=(0,s.useState)([]),[T,E]=(0,s.useState)(!1),[A,L]=(0,s.useState)("myRenderingEngine"),[N,V]=(0,s.useState)(),M=(0,i.AR)();async function R(e){let a=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005)),{ToolGroupManager:i,Enums:l}=a;if(N!==e){let n=i.getToolGroup(t);null==n||n.setToolActive(e,{bindings:[{mouseButton:l.MouseBindings.Primary}]}),N&&(null==n||n.setToolPassive(N)),V(e)}}return(0,s.useEffect)(()=>{async function a(){let{RenderingEngine:t,Enums:a}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),{ViewportType:i}=a,l=new t(A);if(r.current){let t=r.current,n={viewportId:e,element:t,type:i.STACK};null==l||l.enableElement(n);let a=null==l?void 0:l.getViewport(e);null==a||a.render()}}async function i(){let a=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005)),{ToolGroupManager:i,ZoomTool:l,WindowLevelTool:o,LengthTool:s,PanTool:r,utilities:c,Enums:d}=a;a.removeTool(l),a.removeTool(o),a.removeTool(s),a.removeTool(r),a.addTool(l),a.addTool(o),a.addTool(s),a.addTool(r);let u=i.createToolGroup(t);null==u||u.addTool(l.toolName),null==u||u.addTool(o.toolName),null==u||u.addTool(s.toolName),null==u||u.addTool(r.toolName),null==u||u.addViewport(e,A),null==u||u.setToolActive(o.toolName,{bindings:[{mouseButton:d.MouseBindings.Primary}]}),V(o.toolName)}(async function(){let e=await Promise.all([n.e(123),n.e(609),n.e(610),n.e(5),n.e(391),n.e(669),n.e(625)]).then(n.bind(n,51765)).then(e=>e.default).catch(()=>()=>{});await e(),await a(),await i(),S(()=>["wadouri:I0000164.dcm"])})()},[A]),(0,s.useEffect)(()=>{async function t(){let{getRenderingEngine:t}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),a=t(A),i=null==a?void 0:a.getViewport(e);i&&"setStack"in i&&await (null==i?void 0:i.setStack(g,0)),null==i||i.render();let{metaData:l}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),o=["transferSyntax","sopCommonModule","imagePixelModule","voiLutModule"].map(e=>l.get(e,g[0])).filter(e=>!!e).map(e=>Object.entries(e).map(e=>{let[t,n]=e;return{key:t,value:n}})).reduce((e,t)=>[...e,...t],[]);y(()=>o.map((e,t)=>({...e,id:t})))}g.length>0?(E(!1),t()):E(!0)},[A,g]),(0,s.useEffect)(()=>{if(M&&M.loaded){let{cv:e}=M,t=document.querySelector("#viewer canvas");if(t){t.id="canvas-input";let n=e.imread("canvas-input");e.imshow("canvas-output",n)}}},[A,g,M]),(0,a.jsxs)(c.Z,{theme:_,children:[(0,a.jsx)(d.ZP,{}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)("input",{type:"file",accept:"*/dicom",onChange:e=>{e.preventDefault(),e.stopPropagation(),e.target.files&&function(e){async function t(){let t=await n.e(609).then(n.t.bind(n,33245,23)),a=t.wadouri.fileManager.add(e[0]);S(()=>[a])}e&&t()}(e.target.files)},style:{width:"100%"}}),(0,a.jsxs)(o.ZP,{container:!0,children:[(0,a.jsx)(o.ZP,{item:!0,xs:1,children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{WindowLevelTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));R(e.toolName)})()},children:(0,a.jsx)(p.Z,{children:(0,a.jsx)(w.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{PanTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));R(e.toolName)})()},children:(0,a.jsx)(p.Z,{children:(0,a.jsx)(v.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{ZoomTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));R(e.toolName)})()},children:(0,a.jsx)(p.Z,{children:(0,a.jsx)(C.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{LengthTool:e}=await Promise.all([n.e(123),n.e(610),n.e(5),n.e(42)]).then(n.bind(n,52005));R(e.toolName)})()},children:(0,a.jsx)(p.Z,{children:(0,a.jsx)(f.Z,{})})}),(0,a.jsx)(j.Z,{onClick:()=>{(async function(){let{getRenderingEngine:t}=await Promise.all([n.e(123),n.e(610),n.e(391),n.e(439)]).then(n.bind(n,47391)),a=t(A),i=null==a?void 0:a.getViewport(e);null==i||i.resetCamera(),i&&"resetProperties"in i&&(null==i||i.resetProperties()),null==i||i.render()})()},children:(0,a.jsx)(p.Z,{children:(0,a.jsx)(Z.Z,{})})})]})}),(0,a.jsx)(o.ZP,{item:!0,xs:!0,md:!0,children:(0,a.jsx)("div",{id:"viewer",ref:r,style:{maxWidth:"30rem",aspectRatio:1,margin:"0 auto"}})}),(0,a.jsx)(o.ZP,{item:!0,xs:!0,md:!0,children:(0,a.jsx)("canvas",{id:"canvas-output",style:{maxWidth:"30rem",aspectRatio:1,margin:"0 auto"}})})]}),(0,a.jsx)(b,{}),P.length>0&&(0,a.jsxs)(o.ZP,{container:!0,children:[(0,a.jsx)(o.ZP,{item:!0,md:1}),(0,a.jsx)(o.ZP,{item:!0,xs:12,md:!0,children:(0,a.jsx)(h._,{rows:P,columns:k})}),(0,a.jsx)(o.ZP,{item:!0,md:1})]}),(0,a.jsx)(u.Z,{open:T,onClose:()=>{E(!1)},children:(0,a.jsx)(m.Z,{severity:"info",children:"DICOM 파일을 업로드해주세요."})})]})]})}function A(){return(0,a.jsx)(i.mK,{onLoad:e=>{console.log("opencv loaded",e)},openCvPath:"opencv.js",children:(0,a.jsx)(E,{})})}}},function(e){e.O(0,[774,97,886,888,179],function(){return e(e.s=62481)}),_N_E=e.O()}]);