(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[669],{16177:function(e,t,r){"use strict";r.d(t,{Z:function(){return b}});var a=r(62416),n=r(57971),i=r(46138),o=r(14688),s=r(818),l=r(74880),d=r(39040),f=r(82864),c=r(88315),u=r(76342),m=r(6606),h=r(42519),g=e=>{let t=function(e){let t=(0,m.Uu)(),r=[];for(let a=0;a<t.length;a++){let n=t[a],i=h.Z(e,n.id);i.length&&r.push({renderingEngine:n,viewportIds:i.map(e=>e.id)})}return r}(e);t&&t.length&&t.forEach(({renderingEngine:e,viewportIds:t})=>{e.hasBeenDestroyed||e.renderViewports(t)})};function p(e,t){let r=e.length,{rescaleSlope:a,rescaleIntercept:n,suvbw:i}=t;if("PT"===t.modality&&"number"==typeof i)for(let t=0;t<r;t++)e[t]=i*(e[t]*a+n);else for(let t=0;t<r;t++)e[t]=e[t]*a+n;return e}let y=a.Z.Prefetch,{getMinMax:v}=n;class b extends i.Z{constructor(e,t){super(e),this.framesLoaded=0,this.framesProcessed=0,this.cornerstoneImageMetaData=null,this.cancelLoading=()=>{let{loadStatus:e}=this;e&&e.loading&&(e.loading=!1,e.cancelled=!0,this.clearLoadCallbacks(),o.Z.filterRequests(({additionalDetails:e})=>e.volumeId!==this.volumeId))},this.load=(e,t=5)=>{let{imageIds:r,loadStatus:a,numFrames:n}=this;if(!0===a.loading){console.log(`loadVolume: Loading is already in progress for ${this.volumeId}`);return}let{loaded:i}=this.loadStatus,o=r.length;if(i){e&&e({success:!0,framesLoaded:o,framesProcessed:o,numFrames:n,totalNumFrames:o});return}e&&this.loadStatus.callbacks.push(e),this._prefetchImageIds(t)},this.getImageIdsRequests=(e,t,r)=>{let a,n,i;let{loadStatus:o}=this,{cachedFrames:m}=o,{vtkOpenGLTexture:h,imageData:p,metadata:v,volumeId:b}=this,{FrameOfReferenceUID:P}=v,w=t.buffer,I=e.length,E=t.length/I,x=w.byteLength/I;if(t instanceof Uint8Array)a="Uint8Array";else if(t instanceof Float32Array)a="Float32Array";else if(t instanceof Uint16Array)a="Uint16Array";else if(t instanceof Int16Array)a="Int16Array";else throw Error("Unsupported array type");let A=this.imageIds.length;function S(e){(e.framesProcessed>i||e.framesProcessed===e.totalNumFrames)&&(i+=n,g(b)),e.framesProcessed===e.totalNumFrames&&(o.callbacks.forEach(t=>t(e)),(0,s.Z)(l.Z,d.default.IMAGE_VOLUME_LOADING_COMPLETED,{FrameOfReferenceUID:P,volumeId:b}))}i=n=.02*A;let D=(e,t,r)=>{let a=this._imageIdIndexToFrameIndex(t);m[t]=!0,this.framesLoaded++,this.framesProcessed++,h.setUpdatedFrame(a),p.modified(),(0,s.Z)(l.Z,d.default.IMAGE_VOLUME_MODIFIED,{FrameOfReferenceUID:P,imageVolume:e}),this.framesProcessed===A?(o.loaded=!0,o.loading=!1,S({success:!0,imageIdIndex:t,imageId:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,numFrames:I,totalNumFrames:A}),o.callbacks=[]):S({success:!0,imageIdIndex:t,imageId:r,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,numFrames:I,totalNumFrames:A})},T=(e,r,a)=>{let n=this._imageIdIndexToFrameIndex(e),i=f.ZP.getCachedImageBasedOnImageURI(r),s=f.ZP.getVolumeContainingImageId(r);if(o.cancelled){console.warn("volume load cancelled, returning for imageIdIndex: ",e);return}if(!i?.image&&!(s&&s.volume!==this))return D(this,e,r);let l=!!i,d=i||s.volume;this.handleImageComingFromCache(d,l,a,t,n,w,D,e,r,F)};function F(e,t,r){this.framesProcessed++,this.framesProcessed===A?(o.loaded=!0,o.loading=!1,S({success:!1,imageId:r,imageIdIndex:t,error:e,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,numFrames:I,totalNumFrames:A}),o.callbacks=[]):S({success:!1,imageId:r,imageIdIndex:t,error:e,framesLoaded:this.framesLoaded,framesProcessed:this.framesProcessed,numFrames:I,totalNumFrames:A}),(0,s.Z)(l.Z,d.default.IMAGE_LOAD_ERROR,{error:e,imageIdIndex:t,imageId:r})}let O=e.map((e,n)=>{let i=this.getImageIdIndex(e);if(m[i]){this.framesLoaded++,this.framesProcessed++;return}let o=c.get("modalityLutModule",e)||{},s=c.get("generalSeriesModule",e)||{},l={rescaleSlope:o.rescaleSlope,rescaleIntercept:o.rescaleIntercept,modality:s.modality};if("PT"===l.modality){let t=c.get("scalingModule",e);t&&(this._addScalingToVolume(t),l.suvbw=t.suvbw)}let d="number"==typeof l.rescaleSlope&&"number"==typeof l.rescaleIntercept;this.isPreScaled=d;let f={targetBuffer:{arrayBuffer:w instanceof ArrayBuffer?void 0:w,offset:n*x,length:E,type:a},skipCreateImage:!0,preScale:{enabled:!0,scalingParameters:l}};return{callLoadImage:(e,r,a)=>u.loadImage(e,a).then(n=>{(function(e,t,r){if(!(e.buffer instanceof ArrayBuffer))return;let a=r.targetBuffer.offset,n=r.targetBuffer.length,i=t.pixelData?t.pixelData:t.getPixelData();try{if(e instanceof Float32Array){let t=new Float32Array(i);if(t.length!==n)throw"Error pixelData length does not match frame length";e.set(t,a/4)}if(e instanceof Int16Array){let t=new Int16Array(i);if(t.length!==n)throw"Error pixelData length does not match frame length";e.set(t,a/2)}if(e instanceof Uint16Array){let t=new Uint16Array(i);if(t.length!==n)throw"Error pixelData length does not match frame length";e.set(t,a/2)}if(e instanceof Uint8Array){let t=new Uint8Array(i);if(t.length!==n)throw"Error pixelData length does not match frame length";e.set(t,a/1)}}catch(e){console.error(e)}})(t,n,a),T(r,e,l)},t=>{F.call(this,t,r,e)}),imageId:e,imageIdIndex:i,options:f,priority:r,requestType:y,additionalDetails:{volumeId:this.volumeId}}});return O},this.imageIds=t.imageIds,this.loadStatus=t.loadStatus,this.numFrames=this._getNumFrames(),this._createCornerstoneImageMetaData()}_getNumFrames(){let{imageIds:e,scalarData:t}=this,r=this.isDynamicVolume()?t.length:1;return e.length/r}_getScalarDataLength(){let{scalarData:e}=this;return this.isDynamicVolume()?e[0].length:e.length}_createCornerstoneImageMetaData(){let{numFrames:e}=this;if(0===e)return;let t=this.sizeInBytes/e,r=this._getScalarDataLength(),a=r/this.numVoxels,n=this.dimensions[0]*this.dimensions[1]*a,{PhotometricInterpretation:i,voiLut:o,VOILUTFunction:s}=this.metadata,l=[],d=[];o&&o.length&&(l=o.map(e=>e.windowCenter),d=o.map(e=>e.windowWidth)),this.cornerstoneImageMetaData={bytesPerImage:t,numComponents:a,pixelsPerImage:n,windowCenter:l,windowWidth:d,color:a>1,rgba:!1,spacing:this.spacing,dimensions:this.dimensions,photometricInterpretation:i,voiLUTFunction:s,invert:"MONOCHROME1"===i}}_imageIdIndexToFrameIndex(e){return e%this.numFrames}getScalarDataArrays(){return this.isDynamicVolume()?this.scalarData:[this.scalarData]}_getScalarDataByImageIdIndex(e){if(e<0||e>=this.imageIds.length)throw Error("imageIdIndex out of range");let t=Math.floor(e/this.numFrames);return this.getScalarDataArrays()[t]}invalidateVolume(e){let{imageData:t,vtkOpenGLTexture:r}=this,{numFrames:a}=this;for(let e=0;e<a;e++)r.setUpdatedFrame(e);t.modified(),e&&g(this.volumeId)}clearLoadCallbacks(){this.loadStatus.callbacks=[]}handleImageComingFromCache(e,t,r,a,n,i,o,s,l,d){let f=t?e.imageLoadObject:e.convertToCornerstoneImage(l,s);f.promise.then(e=>{let t=this._scaleIfNecessary(e,r),{pixelsPerImage:d,bytesPerImage:f}=this.cornerstoneImageMetaData,c=a.constructor,u=f*n,m=f/d;a.BYTES_PER_ELEMENT!==m&&(u*=a.BYTES_PER_ELEMENT/m);let h=new c(i,u,d);h.set(t),o(this,s,l)}).catch(e=>{d.call(this,e,s,l)})}getImageLoadRequests(e){throw Error("Abstract method")}_prefetchImageIds(e){this.loadStatus.loading=!0;let t=this.getImageLoadRequests(e);t.reverse().forEach(e=>{if(!e)return;let{callLoadImage:t,imageId:r,imageIdIndex:a,options:n,priority:i,requestType:s,additionalDetails:l}=e;o.Z.addRequest(t.bind(this,r,a,n),s,l,i)})}_scaleIfNecessary(e,t){let r=e.preScale?.scaled,a=!t||!t.rescaleIntercept||!t.rescaleSlope;if(!r&&a)return e.getPixelData().slice(0);if(!r&&t&&void 0!==t.rescaleIntercept&&void 0!==t.rescaleSlope){let r=e.getPixelData().slice(0),a=p(r,t);return a}let{rescaleSlope:n,rescaleIntercept:i,suvbw:o}=t,{rescaleSlope:s,rescaleIntercept:l,suvbw:d}=e.preScale.scalingParameters;if(n===s&&i===l&&o===d)return e.getPixelData();let f=e.getPixelData().slice(0),c=n/s,u={...t,rescaleSlope:c,rescaleIntercept:i-l*c,suvbw:o/d},m=p(f,u);return m}_addScalingToVolume(e){if(this.scaling)return;let{suvbw:t,suvlbm:r,suvbsa:a}=e,n={};r&&(n.suvbwToSuvlbm=r/t),a&&(n.suvbwToSuvbsa=a/t),t&&(n.suvbw=t),this.scaling={PT:n}}_removeFromCache(){f.ZP.removeVolumeLoadObject(this.volumeId)}getCornerstoneImage(e,t){let{imageIds:r}=this,a=this._imageIdIndexToFrameIndex(t),{bytesPerImage:n,pixelsPerImage:i,windowCenter:o,windowWidth:s,numComponents:l,color:d,dimensions:f,spacing:u,invert:m,voiLUTFunction:h,photometricInterpretation:g}=this.cornerstoneImageMetaData,p=this._getScalarDataByImageIdIndex(t),y=p.buffer,b=p.constructor,P=n/i,w=n*a;p.BYTES_PER_ELEMENT!==P&&(w*=p.BYTES_PER_ELEMENT/P);let I=new b(i),E=new b(y,w,i);I.set(E);let x=r[t],A=c.get("modalityLutModule",x)||{},S=v(I),D=A.rescaleIntercept?A.rescaleIntercept:0;return{imageId:e,intercept:D,windowCenter:o,windowWidth:s,voiLUTFunction:h,color:d,rgba:!1,numComps:l,rows:f[1],columns:f[0],sizeInBytes:I.byteLength,getPixelData:()=>I,minPixelValue:S.min,maxPixelValue:S.max,slope:A.rescaleSlope?A.rescaleSlope:1,getCanvas:void 0,height:f[0],width:f[1],columnPixelSpacing:u[0],rowPixelSpacing:u[1],invert:m,photometricInterpretation:g}}convertToCornerstoneImage(e,t){return this.getCornerstoneImageLoadObject(e,t)}getCornerstoneImageLoadObject(e,t){let r=this.getCornerstoneImage(e,t),a={promise:Promise.resolve(r)};return a}getCornerstoneImages(){let{imageIds:e}=this;return e.map((e,t)=>this.getCornerstoneImage(e,t))}_convertToImages(){let e=this.sizeInBytes,t=this.imageIds.length,{bytesPerImage:r}=this.cornerstoneImageMetaData,a=f.ZP.decacheIfNecessaryUntilBytesAvailable(e,this.imageIds);for(let e=0;e<t;e++){let t=this.imageIds[e];a-=r;let n=this.convertToCornerstoneImage(t,e);if(f.ZP.getImageLoadObject(t)||f.ZP.putImageLoadObject(t,n).catch(e=>{console.error(e)}),a<=r)break}this._removeFromCache()}decache(e=!1){e?this._removeFromCache():this._convertToImages()}}},86515:function(e,t,r){"use strict";r.d(t,{Z:function(){return y}});var a=r(88315);let n=(e,t)=>e.reduce((e,r)=>((e[r[t]]=e[r[t]]||[]).push(r),e),{});function i(e){let t=e.map(e=>{let t=a.get("petImageModule",e),{frameReferenceTime:r=0}=t??{};return{imageId:e,frameReferenceTime:r}}),r=n(t,"frameReferenceTime"),i=Object.keys(r).map(Number.parseFloat).sort((e,t)=>e-t),o=i.map(e=>r[e].map(e=>e.imageId));return o}var o=function(e){let t=[i];for(let r=0;r<t.length;r++){let a=t[r](e);if(!a||a.length<=1)continue;let n=a[0].length,i=a.every(e=>e.length===n);if(i)return a}return[e]},s=r(57971),l=r(82864),d=r(39040),f=r(77160),c=r(58647),u=r(57945);let{createUint8SharedArray:m,createFloat32SharedArray:h}=s;var g=r(16177);class p extends g.Z{constructor(e,t){p._ensureValidData(e,t),super(e,t),this._timePointIndex=0,this._getTimePointRequests=(e,t)=>{let{imageIds:r,scalarData:a}=e;return this.getImageIdsRequests(r,a,t)},this._getTimePointsRequests=e=>{let t=this._getTimePointsToLoad(),r=[];return t.forEach(t=>{let a=this._getTimePointRequests(t,e);r=r.concat(a)}),r},this.getImageLoadRequests=e=>this._getTimePointsRequests(e).reverse(),this._numTimePoints=this.scalarData.length,this._timePoints=this._getTimePointsData()}static _ensureValidData(e,t){let r=t.imageIds,a=e.scalarData;if(r.length%a.length!=0)throw Error(`Number of imageIds is not a multiple of ${a.length}`)}_getTimePointsData(){let{imageIds:e}=this,t=this.scalarData,{numFrames:r}=this,a=t.length,n=[];for(let i=0;i<a;i++){let a=i*r,o=a+r;n.push({imageIds:e.slice(a,o),scalarData:t[i]})}return n}_getTimePointsToLoad(){let e=this._timePoints,t=this._timePointIndex,r=[e[t]],a=t-1,n=t+1;for(;a>=0||n<e.length;)a>=0&&r.push(e[a--]),n<e.length&&r.push(e[n++]);return r}isDynamicVolume(){return!0}get timePointIndex(){return this._timePointIndex}set timePointIndex(e){if(e<0||e>=this.numTimePoints)throw Error(`Invalid timePointIndex (${e})`);if(this._timePointIndex===e)return;let{imageData:t}=this;this._timePointIndex=e,t.getPointData().setActiveScalars(`timePoint-${e}`),this.invalidateVolume(!0)}get numTimePoints(){return this._numTimePoints}getScalarData(){return this.scalarData[this._timePointIndex]}}var y=function(e,t){if(!t||!t.imageIds||!t.imageIds.length)throw Error("ImageIds must be provided to create a 4D streaming image volume");let{imageIds:r}=t,a=function(e){let t=o(e);return t.map(e=>(function(e){let t;let r=(0,c.Z)(e),{BitsAllocated:a,PixelRepresentation:n,PhotometricInterpretation:i,ImageOrientationPatient:o,PixelSpacing:s,Columns:g,Rows:p}=r,y=f.fromValues(o[0],o[1],o[2]),v=f.fromValues(o[3],o[4],o[5]),b=f.create();f.cross(b,y,v);let{zSpacing:P,origin:w,sortedImageIds:I}=(0,u.Z)(e,b),E=e.length,x=[s[1],s[0],P],A=[g,p,E],S=[...y,...v,...b],D=(16===a?4:1)*A[0]*A[1]*A[2],T=1;"RGB"===i&&(T=3);let F=D*T,O=l.ZP.isCacheable(F);if(!O)throw Error(d.default.CACHE_SIZE_EXCEEDED);switch(l.ZP.decacheIfNecessaryUntilBytesAvailable(F),a){case 8:if(1===n)throw Error("8 Bit signed images are not yet supported by this plugin.");t=m(A[0]*A[1]*A[2]);break;case 16:t=h(A[0]*A[1]*A[2]);break;case 24:t=m(A[0]*A[1]*A[2]*T)}return{metadata:r,sortedImageIds:I,dimensions:A,spacing:x,origin:w,direction:S,scalarData:t,sizeInBytes:F}})(e))}(r),{metadata:n,dimensions:i,spacing:s,origin:g,direction:y,sizeInBytes:v}=a[0],b=[],P=[];a.forEach(e=>{b.push(e.sortedImageIds),P.push(e.scalarData)});let w=new p({volumeId:e,metadata:n,dimensions:i,spacing:s,origin:g,direction:y,scalarData:P,sizeInBytes:v},{imageIds:b.flat(),loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}});return{promise:Promise.resolve(w),decache:()=>{w.destroy(),w=null},cancel:()=>{w.cancelLoading()}}}},56686:function(e,t,r){"use strict";r.d(t,{Z:function(){return P}});var a=r(57971),n=r(64060),i=r(14688),o=r(76342),s=r(62416),l=r(3295),d=r(82864),f=r(39040),c=r(77160),u=r(58647),m=r(57945),h=r(16177);class g extends h.Z{constructor(e,t){super(e,t),this.getImageLoadRequests=e=>{let{imageIds:t}=this,r=this.scalarData;return this.getImageIdsRequests(t,r,e)}}getScalarData(){return this.scalarData}}let{createUint8SharedArray:p,createFloat32SharedArray:y,createUint16SharedArray:v,createInt16SharedArray:b}=a;var P=function(e,t){if(!t||!t.imageIds||!t.imageIds.length)throw Error("ImageIds must be provided to create a streaming image volume");let{useNorm16Texture:r,preferSizeOverAccuracy:a}=(0,n.P_)().rendering,h=r||a;async function P(){let r,a;if("wadouri"===t.imageIds[0].split(":")[0]){let[r,a]=[Math.floor(t.imageIds.length/2),t.imageIds.length-1];await Promise.all([0,r,a].map(r=>new Promise((a,n)=>{let l=t.imageIds[r];i.Z.addRequest(async()=>{o.loadImage(l).then(()=>{console.log(`Prefetched imageId: ${l}`),a(!0)}).catch(e=>{n(e)})},s.Z.Prefetch,{volumeId:e},1)}))).catch(console.error)}let{imageIds:P}=t,w=(0,u.Z)(P),I=Math.floor(P.length/2),E=P[I],x=l.Z(E),A=x.rescaleIntercept<0||x.rescaleSlope<0,{BitsAllocated:S,PixelRepresentation:D,PhotometricInterpretation:T,ImageOrientationPatient:F,PixelSpacing:O,Columns:U,Rows:L}=w,B=c.fromValues(F[0],F[1],F[2]),_=c.fromValues(F[3],F[4],F[5]),k=c.create();c.cross(k,B,_);let{zSpacing:q,origin:C,sortedImageIds:M}=(0,m.Z)(P,k),N=P.length,Z=[O[1],O[0],q],R=[U,L,N],V=[...B,..._,...k],j=1===D,G="RGB"===T?3:1,z=(0,n.hG)(),J=R[0]*R[1]*R[2],H=e=>{if(!d.ZP.isCacheable(e))throw Error(f.default.CACHE_SIZE_EXCEEDED);d.ZP.decacheIfNecessaryUntilBytesAvailable(e)};switch(S){case 8:if(j)throw Error("8 Bit signed images are not yet supported by this plugin.");H(a=J*G),r=z?p(J*G):new Uint8Array(J*G);break;case 16:if(!h){a=4*J,r=z?y(J):new Float32Array(J);break}if(a=2*J,j||A){H(a),r=z?b(J):new Int16Array(J);break}if(!j&&!A){H(a),r=z?v(J):new Uint16Array(J);break}H(a=4*J),r=z?y(J):new Float32Array(J);break;case 24:H(a=J*G),r=z?p(J*G):new Uint8Array(J*G)}let W=new g({volumeId:e,metadata:w,dimensions:R,spacing:Z,origin:C,direction:V,scalarData:r,sizeInBytes:a},{imageIds:M,loadStatus:{loaded:!1,loading:!1,cancelled:!1,cachedFrames:[],callbacks:[]}});return W}let w=P();return{promise:w,decache:()=>{w.then(e=>{e.destroy(),e=null})},cancel:()=>{w.then(e=>{e.cancelLoading()})}}}},58647:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(88315);function n(e){let t;let r=e[0],{pixelRepresentation:n,bitsAllocated:i,bitsStored:o,highBit:s,photometricInterpretation:l,samplesPerPixel:d}=a.get("imagePixelModule",r),f=[],c=a.get("voiLutModule",r);if(c){let{windowWidth:e,windowCenter:r}=c;if(t=c?.voiLUTFunction,Array.isArray(e))for(let t=0;t<e.length;t++)f.push({windowWidth:e[t],windowCenter:r[t]});else f.push({windowWidth:e,windowCenter:r})}else f.push({windowWidth:void 0,windowCenter:void 0});let{modality:u,seriesInstanceUID:m}=a.get("generalSeriesModule",r),{imageOrientationPatient:h,pixelSpacing:g,frameOfReferenceUID:p,columns:y,rows:v}=a.get("imagePlaneModule",r);return{BitsAllocated:i,BitsStored:o,SamplesPerPixel:d,HighBit:s,PhotometricInterpretation:l,PixelRepresentation:n,Modality:u,ImageOrientationPatient:h,PixelSpacing:g,FrameOfReferenceUID:p,Columns:y,Rows:v,voiLut:f,VOILUTFunction:t,SeriesInstanceUID:m}}},57945:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var a=r(77160),n=r(88315),i=r(64060);function o(e,t){let r,o;let{imagePositionPatient:s}=n.get("imagePlaneModule",e[0]),l=a.create(),d="wadouri"===e[0].split(":")[0];function f(e){let{imagePositionPatient:r}=n.get("imagePlaneModule",e),i=a.create();return a.sub(i,s,r),a.dot(i,t)}if(a.set(l,s[0],s[1],s[2]),d){let i=[e[0],e[Math.floor(e.length/2)]];r=e;let l=f(i[0]),d=f(i[1]);l-d<0&&r.reverse();let c=n.get("imagePlaneModule",i[1]);if(!c)throw Error("Incomplete metadata required for volume construction.");let u=a.create();a.sub(u,s,c.imagePositionPatient);let m=a.dot(u,t);o=Math.abs(m)/Math.floor(e.length/2)}else{let t=e.map(e=>{let t=f(e);return{distance:t,imageId:e}});t.sort((e,t)=>t.distance-e.distance),r=t.map(e=>e.imageId);let a=t.length;o=Math.abs(t[a-1].distance-t[0].distance)/(a-1)}let{imagePositionPatient:c,sliceThickness:u}=n.get("imagePlaneModule",r[0]),{strictZSpacingForVolumeViewport:m}=(0,i.P_)().rendering;0!==o||m||(u?(console.log("Could not calculate zSpacing. Using sliceThickness"),o=u):(console.log("Could not calculate zSpacing. The VolumeViewport visualization is compromised. Setting zSpacing to 1 to render"),o=1));let h={zSpacing:o,origin:c,sortedImageIds:r};return h}},34705:function(e,t,r){var a=r(21876).Buffer,n=r(83454);e.exports=function(e){var t,r;return t=[function(t,r){t.exports=e},function(e,t,r){"use strict";r.r(t),r.d(t,"isStringVr",function(){return o}),r.d(t,"isPrivateTag",function(){return s}),r.d(t,"parsePN",function(){return l}),r.d(t,"parseTM",function(){return d}),r.d(t,"parseDA",function(){return f}),r.d(t,"explicitElementToString",function(){return c}),r.d(t,"explicitDataSetToJS",function(){return u}),r.d(t,"createJPEGBasicOffsetTable",function(){return h}),r.d(t,"parseDicomDataSetExplicit",function(){return O}),r.d(t,"parseDicomDataSetImplicit",function(){return U}),r.d(t,"readFixedString",function(){return v}),r.d(t,"alloc",function(){return L}),r.d(t,"version",function(){return B}),r.d(t,"bigEndianByteArrayParser",function(){return _}),r.d(t,"ByteStream",function(){return C}),r.d(t,"sharedCopy",function(){return k}),r.d(t,"DataSet",function(){return w}),r.d(t,"findAndSetUNElementLength",function(){return y}),r.d(t,"findEndOfEncapsulatedElement",function(){return p}),r.d(t,"findItemDelimitationItemAndSetElementLength",function(){return I}),r.d(t,"littleEndianByteArrayParser",function(){return M}),r.d(t,"parseDicom",function(){return Z}),r.d(t,"readDicomElementExplicit",function(){return F}),r.d(t,"readDicomElementImplicit",function(){return E}),r.d(t,"readEncapsulatedImageFrame",function(){return z}),r.d(t,"readEncapsulatedPixelData",function(){return H}),r.d(t,"readEncapsulatedPixelDataFromFragments",function(){return V}),r.d(t,"readPart10Header",function(){return N}),r.d(t,"readSequenceItemsExplicit",function(){return T}),r.d(t,"readSequenceItemsImplicit",function(){return S}),r.d(t,"readSequenceItem",function(){return x}),r.d(t,"readTag",function(){return g});var i={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0},o=function(e){return i[e]},s=function(e){if(isNaN(e=parseInt(e[4],16)))throw"dicomParser.isPrivateTag: cannot parse last character of group";return e%2==1},l=function(e){if(void 0!==e)return{familyName:(e=e.split("^"))[0],givenName:e[1],middleName:e[2],prefix:e[3],suffix:e[4]}};function d(e,t){if(2<=e.length){var r=parseInt(e.substring(0,2),10),a=4<=e.length?parseInt(e.substring(2,4),10):void 0,n=6<=e.length?parseInt(e.substring(4,6),10):void 0,i=8<=e.length?e.substring(7,13):void 0,i=i?parseInt(i,10)*Math.pow(10,6-i.length):void 0;if(t&&(isNaN(r)||void 0!==a&&isNaN(a)||void 0!==n&&isNaN(n)||void 0!==i&&isNaN(i)||r<0||23<r||a&&(a<0||59<a)||n&&(n<0||59<n)||i&&(i<0||999999<i)))throw"invalid TM '".concat(e,"'");return{hours:r,minutes:a,seconds:n,fractionalSeconds:i}}if(t)throw"invalid TM '".concat(e,"'")}function f(e,t){if(e&&8===e.length){var r=parseInt(e.substring(0,4),10),a=parseInt(e.substring(4,6),10),n=parseInt(e.substring(6,8),10);if(t&&!0!=(!isNaN(r)&&0<a&&a<=12&&0<n&&n<=function(e,t){switch(e){case 2:return t%4==0&&t%100||t%400==0?29:28;case 9:case 4:case 6:case 11:return 30;default:return 31}}(a,r)))throw"invalid DA '".concat(e,"'");return{year:r,month:a,day:n}}if(t)throw"invalid DA '".concat(e,"'")}function c(e,t){if(void 0===e||void 0===t)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===t.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,a=t.vr,n=t.tag;function i(t,r){for(var a="",i=0;i<t;i++)0!==i&&(a+="/"),a+=r.call(e,n,i).toString();return a}if(!0===o(a))r=e.string(n);else{if("AT"===a){var s=e.uint32(n);return void 0===s?void 0:"x".concat((s=s<0?4294967295+s+1:s).toString(16).toUpperCase())}"US"===a?r=i(t.length/2,e.uint16):"SS"===a?r=i(t.length/2,e.int16):"UL"===a?r=i(t.length/4,e.uint32):"SL"===a?r=i(t.length/4,e.int32):"FD"===a?r=i(t.length/8,e.double):"FL"===a&&(r=i(t.length/4,e.float))}return r}function u(e,t){if(void 0===e)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";t=t||{omitPrivateAttibutes:!0,maxElementLength:128};var r,a={};for(r in e.elements){var n=e.elements[r];if(!0!==t.omitPrivateAttibutes||!s(r)){if(n.items){for(var i=[],o=0;o<n.items.length;o++)i.push(u(n.items[o].dataSet,t));a[r]=i}else{var l=void 0;n.length<t.maxElementLength&&(l=c(e,n)),a[r]=void 0!==l?l:{dataOffset:n.dataOffset,length:n.length}}}}return a}function m(e,t){return 255===e.byteArray[t]&&217===e.byteArray[t+1]}function h(e,t,r){if(void 0===e)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter dataSet";if(void 0===t)throw"dicomParser.createJPEGBasicOffsetTable: missing required parameter pixelDataElement";if("x7fe00010"!==t.tag)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010'";if(!0!==t.encapsulatedPixelData||!0!==t.hadUndefinedLength||void 0===t.basicOffsetTable||void 0===t.fragments||t.fragments.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r&&r.length<=0)throw"dicomParser.createJPEGBasicOffsetTable: parameter 'fragments' must not be zero length";r=r||t.fragments;for(var a=[],n=0;;){a.push(t.fragments[n].offset);var i=function(e,t,r){for(var a,n=r;n<t.fragments.length;n++)if(a=n,!(!m(e,(a=t.fragments[a]).position+a.length-2)&&!m(e,a.position+a.length-3)))return n}(e,t,n);if(void 0===i||i===t.fragments.length-1)return a;n=i+1}}function g(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,e=e.readUint16();return"x".concat("00000000".concat((t+e).toString(16)).substr(-8))}function p(e,t,r){if(void 0===e)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";if(t.encapsulatedPixelData=!0,t.basicOffsetTable=[],t.fragments=[],"xfffee000"!==g(e))throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var a=e.readUint32()/4,n=0;n<a;n++){var i=e.readUint32();t.basicOffsetTable.push(i)}for(var o=e.position;e.position<e.byteArray.length;){var s=g(e),l=e.readUint32();if("xfffee0dd"===s)return e.seek(l),void(t.length=e.position-t.dataOffset);if("xfffee000"!==s)return r&&r.push("unexpected tag ".concat(s," while searching for end of pixel data element with undefined length")),l>e.byteArray.length-e.position&&(l=e.byteArray.length-e.position),t.fragments.push({offset:e.position-o-8,position:e.position,length:l}),e.seek(l),void(t.length=e.position-t.dataOffset);t.fragments.push({offset:e.position-o-8,position:e.position,length:l}),e.seek(l)}r&&r.push("pixel data element ".concat(t.tag," missing sequence delimiter tag xfffee0dd"))}function y(e,t){if(void 0===e)throw"dicomParser.findAndSetUNElementLength: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;)if(65534===e.readUint16()&&57565===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function v(e,t,r){if(r<0)throw"dicomParser.readFixedString - length cannot be less than 0";if(t+r>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var a,n="",i=0;i<r;i++){if(0===(a=e[t+i]))return t+=r,n;n+=String.fromCharCode(a)}return n}function b(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function P(e,t){return void 0!==e.parser?e.parser:t}var w=function(){var e,t;function r(e,t,a){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,r),this.byteArrayParser=e,this.byteArray=t,this.elements=a}return e=[{key:"uint16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return P(e,this.byteArrayParser).readUint16(this.byteArray,e.dataOffset+2*t)}},{key:"int16",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return P(e,this.byteArrayParser).readInt16(this.byteArray,e.dataOffset+2*t)}},{key:"uint32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return P(e,this.byteArrayParser).readUint32(this.byteArray,e.dataOffset+4*t)}},{key:"int32",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return P(e,this.byteArrayParser).readInt32(this.byteArray,e.dataOffset+4*t)}},{key:"float",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return P(e,this.byteArrayParser).readFloat(this.byteArray,e.dataOffset+4*t)}},{key:"double",value:function(e,t){if(t=void 0!==t?t:0,(e=this.elements[e])&&0!==e.length)return P(e,this.byteArrayParser).readDouble(this.byteArray,e.dataOffset+8*t)}},{key:"numStringValues",value:function(e){if((e=this.elements[e])&&0<e.length)return null===(e=v(this.byteArray,e.dataOffset,e.length).match(/\\/g))?1:e.length+1}},{key:"string",value:function(e,t){return(e=this.elements[e])&&e.Value?e.Value:e&&0<e.length?(e=v(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].trim():e.trim()):void 0}},{key:"text",value:function(e,t){if((e=this.elements[e])&&0<e.length)return e=v(this.byteArray,e.dataOffset,e.length),0<=t?e.split("\\")[t].replace(/ +$/,""):e.replace(/ +$/,"")}},{key:"floatString",value:function(e,t){var r=this.elements[e];if(r&&0<r.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseFloat(t)}},{key:"intString",value:function(e,t){var r=this.elements[e];if(r&&0<r.length&&void 0!==(t=this.string(e,t=void 0!==t?t:0)))return parseInt(t)}},{key:"attributeTag",value:function(e){var t=this.elements[e];if(t&&4===t.length){var r=P(t,this.byteArrayParser).readUint16,e=this.byteArray,t=t.dataOffset;return"x".concat("00000000".concat((256*r(e,t)*256+r(e,t+2)).toString(16)).substr(-8))}}}],b(r.prototype,e),t&&b(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}();function I(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var r=e.byteArray.length-8;e.position<=r;)if(65534===e.readUint16()&&57357===e.readUint16())return 0!==e.readUint32()&&e.warnings("encountered non zero length following item delimiter at position ".concat(e.position-4," while reading element of undefined length with tag ").concat(t.tag)),void(t.length=e.position-t.dataOffset);t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)}function E(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var a,n=g(e),n={tag:n,vr:void 0!==r?r(n):void 0,length:e.readUint32(),dataOffset:e.position};return 4294967295===n.length&&(n.hadUndefinedLength=!0),n.tag===t||((void 0!==(a=n).vr?"SQ"!==a.vr:e.position+4<=e.byteArray.length?(a=g(e),e.seek(-4),"xfffee000"!==a&&"xfffee0dd"!==a):(e.warnings.push("eof encountered before finding sequence item tag or sequence delimiter tag in peeking to determine VR"),!0))||s(n.tag)&&!n.hadUndefinedLength?n.hadUndefinedLength?I(e,n):e.seek(n.length):(S(e,n,r),s(n.tag)&&(n.items=void 0))),n}function x(e){if(void 0===e)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var t={tag:g(e),length:e.readUint32(),dataOffset:e.position};if("xfffee000"!==t.tag)throw"dicomParser.readSequenceItem: item tag (FFFE,E000) not found at offset ".concat(e.position);return t}function A(e,t){var r=x(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=E(e,void 0,t);if("xfffee00d"===(r[a.tag]=a).tag)return new w(e.byteArrayParser,e.byteArray,r)}return e.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new w(e.byteArrayParser,e.byteArray,{}),U(r.dataSet,e,e.position+r.length,{vrCallback:t})),r}function S(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var a=g(e);if(e.seek(-4),"xfffee0dd"===a)return t.length=e.position-t.dataOffset,e.seek(8);a=A(e,r),t.items.push(a)}e.warnings.push("eof encountered before finding sequence delimiter in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}:function(e,t,r){for(var a=t.dataOffset+t.length;e.position<a;){var n=A(e,r);t.items.push(n)}})(e,t,r)}function D(e,t){var r=x(e);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=function(e,t){for(var r={};e.position<e.byteArray.length;){var a=F(e,t);if("xfffee00d"===(r[a.tag]=a).tag)return new w(e.byteArrayParser,e.byteArray,r)}return t.push("eof encountered before finding item delimiter tag while reading sequence item of undefined length"),new w(e.byteArrayParser,e.byteArray,r)}(e,t),r.length=e.position-r.dataOffset):(r.dataSet=new w(e.byteArrayParser,e.byteArray,{}),O(r.dataSet,e,e.position+r.length)),r}function T(e,t,r){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],(4294967295===t.length?function(e,t,r){for(;e.position+4<=e.byteArray.length;){var a=g(e);if(e.seek(-4),"xfffee0dd"===a)return t.length=e.position-t.dataOffset,e.seek(8);a=D(e,r),t.items.push(a)}r.push("eof encountered before finding sequence delimitation tag while reading sequence of undefined length"),t.length=e.position-t.dataOffset}:function(e,t,r){for(var a=t.dataOffset+t.length;e.position<a;){var n=D(e,r);t.items.push(n)}})(e,t,r)}function F(e,t,r){if(void 0===e)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var a,n={tag:g(e),vr:e.readFixedString(2)};return 2==("OB"===(a=n.vr)||"OD"===a||"OL"===a||"OW"===a||"SQ"===a||"OF"===a||"UC"===a||"UR"===a||"UT"===a||"UN"===a?4:2)?n.length=e.readUint16():(e.seek(2),n.length=e.readUint32()),n.dataOffset=e.position,4294967295===n.length&&(n.hadUndefinedLength=!0),n.tag===r||("SQ"===n.vr?T(e,n,t):4294967295===n.length?"x7fe00010"===n.tag?p(e,n,t):("UN"===n.vr?S:I)(e,n):e.seek(n.length)),n}function O(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?t.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxP osition'";for(var n=e.elements;t.position<r;){var i=F(t,e.warnings,a.untilTag);if((n[i.tag]=i).tag===a.untilTag)return}if(t.position>r)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"}function U(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(r=void 0===r?e.byteArray.length:r,void 0===t)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<t.position||r>t.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var n=e.elements;t.position<r;){var i=E(t,a.untilTag,a.vrCallback);if((n[i.tag]=i).tag===a.untilTag)return}}function L(e,t){if(void 0!==a&&e instanceof a)return a.alloc(t);if(e instanceof Uint8Array)return new Uint8Array(t);throw"dicomParser.alloc: unknown type for byteArray"}var B="1.8.12",_={readUint16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";return t=32768&(t=(e[t]<<8)+e[t+1])?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";return 256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3]},readInt32:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3]},readFloat:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[3]=e[t],r[2]=e[t+1],r[1]=e[t+2],r[0]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[7]=e[t],r[6]=e[t+1],r[5]=e[t+2],r[4]=e[t+3],r[3]=e[t+4],r[2]=e[t+5],r[1]=e[t+6],r[0]=e[t+7],new Float64Array(r.buffer)[0]}};function k(e,t,r){if(void 0!==a&&e instanceof a)return e.slice(t,t+r);if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset+t,r);throw"dicomParser.from: unknown type for byteArray"}function q(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var C=function(){var e,t;function r(e,t,n){if(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==!1&&(void 0===a||t instanceof a==!1))throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array or Buffer";if(n<0)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n||0,this.warnings=[]}return e=[{key:"seek",value:function(e){if(this.position+e<0)throw"dicomParser.ByteStream.prototype.seek: cannot seek to position < 0";this.position+=e}},{key:"readByteStream",value:function(e){if(this.position+e>this.byteArray.length)throw"dicomParser.ByteStream.prototype.readByteStream: readByteStream - buffer overread";var t=k(this.byteArray,this.position,e);return this.position+=e,new r(this.byteArrayParser,t)}},{key:"getSize",value:function(){return this.byteArray.length}},{key:"readUint16",value:function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e}},{key:"readUint32",value:function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e}},{key:"readFixedString",value:function(e){var t=v(this.byteArray,this.position,e);return this.position+=e,t}}],q(r.prototype,e),t&&q(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}(),M={readUint16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";return t=32768&(t=e[t]+(e[t+1]<<8))?t-65535-1:t},readUint32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";return e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*65536},readInt32:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)},readFloat:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var r=new Uint8Array(4);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],new Float32Array(r.buffer)[0]},readDouble:function(e,t){if(t<0)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var r=new Uint8Array(8);return r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2],r[3]=e[t+3],r[4]=e[t+4],r[5]=e[t+5],r[6]=e[t+6],r[7]=e[t+7],new Float64Array(r.buffer)[0]}};function N(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw"dicomParser.readPart10Header: missing required parameter 'byteArray'";var r=t.TransferSyntaxUID,a=new C(M,e);return function(){var e=function(){if(132>=a.getSize()&&r)return!1;if(a.seek(128),"DICM"===a.readFixedString(4))return!0;if(!(t||{}).TransferSyntaxUID)throw"dicomParser.readPart10Header: DICM prefix not found at location 132 - this is not a valid DICOM P10 file.";return a.seek(0),!1}(),n=[],i={};if(!e)return a.position=0,{elements:{x00020010:{tag:"x00020010",vr:"UI",Value:r}},warnings:n};for(;a.position<a.byteArray.length;){var o=a.position,s=F(a,n);if("x0002ffff"<s.tag){a.position=o;break}s.parser=M,i[s.tag]=s}return(e=new w(a.byteArrayParser,a.byteArray,i)).warnings=a.warnings,e.position=a.position,e}()}function Z(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw Error("dicomParser.parseDicom: missing required parameter 'byteArray'");var a,i=function(t){if(void 0===t.elements.x00020010)throw Error("dicomParser.parseDicom: missing required meta header attribute 0002,0010");return(t=t.elements.x00020010)&&t.Value||v(e,t.dataOffset,t.length)};return function(e,t){for(var r in e.elements)e.elements.hasOwnProperty(r)&&(t.elements[r]=e.elements[r]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}(a=N(e,t),function(a){var o=i(a),s="1.2.840.10008.1.2"!==o,o=function(a,i){var o="[object process]"===Object.prototype.toString.call(void 0!==n?n:0);if("1.2.840.10008.1.2.1.99"!==a)return new C("1.2.840.10008.1.2.2"===a?_:M,e,i);if(t&&t.inflater)return a=t.inflater(e,i),new C(M,a,0);if(!0==o){var s=r(0),l=k(e,i,e.length-i),s=s.inflateRawSync(l),l=L(e,s.length+i);return e.copy(l,0,0,i),s.copy(l,i),new C(M,l,0)}if("undefined"==typeof pako)throw"dicomParser.parseDicom: no inflater available to handle deflate transfer syntax";return s=e.slice(i),l=pako.inflateRaw(s),(s=L(e,l.length+i)).set(e.slice(0,i),0),s.set(l,i),new C(M,s,0)}(o,a.position),a=new w(o.byteArrayParser,o.byteArray,{});a.warnings=o.warnings;try{(s?O:U)(a,o,o.byteArray.length,t)}catch(e){throw{exception:e,dataSet:a}}return a}(a))}var R=function(e,t,r){for(var a=0,n=t;n<t+r;n++)a+=e[n].length;return a};function V(e,t,r,a,n){if(n=n||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'startFragmentIndex'";if(void 0===(a=a||1))throw"dicomParser.readEncapsulatedPixelDataFromFragments: missing required parameter 'numFragments'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010";if(!0!==t.encapsulatedPixelData||!0!==t.hadUndefinedLength||void 0===t.basicOffsetTable||void 0===t.fragments||t.fragments.length<=0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be >= 0";if(r>=t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragmentIndex' must be < number of fragments";if(a<1)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'numFragments' must be > 0";if(r+a>t.fragments.length)throw"dicomParser.readEncapsulatedPixelDataFromFragments: parameter 'startFragment' + 'numFragments' < number of fragments";var i=new C(e.byteArrayParser,e.byteArray,t.dataOffset),t=x(i);if("xfffee000"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";i.seek(t.length);var o=i.position;if(1===a)return k(i.byteArray,o+n[r].offset+8,n[r].length);for(var t=R(n,r,a),s=L(i.byteArray,t),l=0,d=r;d<r+a;d++)for(var f=o+n[d].offset+8,c=0;c<n[d].length;c++)s[l++]=i.byteArray[f++];return s}var j=function(e,t){for(var r=0;r<e.length;r++)if(e[r].offset===t)return r},G=function(e,t,r,a){if(e===t.length-1)return r.length-a;for(var n=t[e+1],i=a+1;i<r.length;i++)if(r[i].offset===n)return i-a;throw"dicomParser.calculateNumberOfFragmentsForFrame: could not find fragment with offset matching basic offset table"};function z(e,t,r,a,n){if(a=a||t.basicOffsetTable,n=n||t.fragments,void 0===e)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'pixelDataElement'";if(void 0===r)throw"dicomParser.readEncapsulatedImageFrame: missing required parameter 'frameIndex'";if(void 0===a)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' does not have basicOffsetTable";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have encapsulated pixel data";if(!0!==t.hadUndefinedLength)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have undefined length";if(void 0===t.fragments)throw"dicomParser.readEncapsulatedImageFrame: parameter 'pixelDataElement' refers to pixel data element that does not have fragments";if(0===a.length)throw"dicomParser.readEncapsulatedImageFrame: basicOffsetTable has zero entries";if(r<0)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be >= 0";if(r>=a.length)throw"dicomParser.readEncapsulatedImageFrame: parameter 'frameIndex' must be < basicOffsetTable.length";var i=a[r],i=j(n,i);if(void 0===i)throw"dicomParser.readEncapsulatedImageFrame: unable to find fragment that matches basic offset table entry";return V(e,t,i,G(r,a,n,i),n)}var J=!1;function H(e,t,r){if(J||(J=!0,console&&console.log&&console.log("WARNING: dicomParser.readEncapsulatedPixelData() has been deprecated")),void 0===e)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===r)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==t.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010)";if(!0!==t.encapsulatedPixelData||!0!==t.hadUndefinedLength||void 0===t.basicOffsetTable||void 0===t.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(r<0)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";return 0!==t.basicOffsetTable.length?z(e,t,r):V(e,t,0,t.fragments.length)}t.default={isStringVr:o,isPrivateTag:s,parsePN:l,parseTM:d,parseDA:f,explicitElementToString:c,explicitDataSetToJS:u,createJPEGBasicOffsetTable:h,parseDicomDataSetExplicit:O,parseDicomDataSetImplicit:U,readFixedString:v,alloc:L,version:B,bigEndianByteArrayParser:_,ByteStream:C,sharedCopy:k,DataSet:w,findAndSetUNElementLength:y,findEndOfEncapsulatedElement:p,findItemDelimitationItemAndSetElementLength:I,littleEndianByteArrayParser:M,parseDicom:Z,readDicomElementExplicit:F,readDicomElementImplicit:E,readEncapsulatedImageFrame:z,readEncapsulatedPixelData:H,readEncapsulatedPixelDataFromFragments:V,readPart10Header:N,readSequenceItemsExplicit:T,readSequenceItemsImplicit:S,readSequenceItem:x,readTag:g,LEI:"1.2.840.10008.1.2",LEE:"1.2.840.10008.1.2.1"}}],r={},i.m=t,i.c=r,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t||4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,(function(t){return e[t]}).bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1);function i(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,i),a.l=!0,a.exports}}(r(23848))},83454:function(e,t,r){"use strict";var a,n;e.exports=(null==(a=r.g.process)?void 0:a.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(77663)},77663:function(e){!function(){var t={229:function(e){var t,r,a,n=e.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l=[],d=!1,f=-1;function c(){d&&a&&(d=!1,a.length?l=a.concat(l):f=-1,l.length&&u())}function u(){if(!d){var e=s(c);d=!0;for(var t=l.length;t;){for(a=l,l=[];++f<t;)a&&a[f].run();f=-1,t=l.length}a=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new m(e,t)),1!==l.length||d||s(u)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function a(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}},o=!0;try{t[e](i,i.exports,a),o=!1}finally{o&&delete r[e]}return i.exports}a.ab="//";var n=a(229);e.exports=n}()}}]);